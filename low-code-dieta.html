<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Menu Low-Code</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Container Principal (simulando a interface do Lovable) -->
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-2xl">
        <h1 class="text-3xl font-bold text-center mb-2">Gerador de Menu Diário</h1>
        <p class="text-center text-sm mb-6 text-gray-500">Uma simulação de um app Low-Code para dietas terapêuticas.</p>

        <!-- Seção de Ações -->
        <div class="flex flex-col items-center mb-6">
            <button id="generateMenuBtn" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:bg-blue-700 transition duration-300">
                Gerar Meu Menu de Hoje
            </button>
        </div>

        <!-- Mensagem de carregamento -->
        <div id="loading" class="hidden text-center text-gray-500 font-medium">
            Gerando seu menu...
        </div>

        <!-- Mensagem de erro -->
        <div id="error-message" class="hidden text-center text-red-500 font-medium">
            <!-- Mensagens de erro serão exibidas aqui -->
        </div>
        
        <!-- Mensagem de sucesso -->
        <div id="success-message" class="hidden text-center text-green-500 font-medium mb-4">
            Menu gerado com sucesso!
        </div>

        <!-- Seção do Menu Gerado -->
        <div id="menu-container" class="hidden">
            <h2 class="text-2xl font-semibold mb-4 text-center">Seu Menu Diário</h2>
            <div id="menu-content" class="space-y-6">
                <!-- Conteúdo do menu será injetado aqui pelo JavaScript -->
            </div>
            <div class="mt-6 text-center text-sm font-medium">
                <span id="total-carbs" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-full">Carboidratos Totais: 0g</span>
            </div>
        </div>

    </div>

    <script>
        // Simulação do back-end do Make
        const data = [
            // Itens de 0g CHO
            { "CHO(g)": 0.00, "Alimento": "CAFÉ DESCAFEINADO", "Medida Usual": "XÍCARA", "g ou ml": 240, "Calorias (kcal)": 0 },
            { "CHO(g)": 0.00, "Alimento": "SOJA COZIDA", "Medida Usual": "COLHER DE SOPA", "g ou ml": 15, "Calorias (kcal)": 20 },
            { "CHO(g)": 0.00, "Alimento": "OVO COZIDO", "Medida Usual": "UNIDADE", "g ou ml": 50, "Calorias (kcal)": 75 },
            { "CHO(g)": 0.00, "Alimento": "MAIONESE", "Medida Usual": "COLHER DE SOPA", "g ou ml": 15, "Calorias (kcal)": 90 },
            { "CHO(g)": 0.00, "Alimento": "CREME DE LEITE", "Medida Usual": "COPO", "g ou ml": 200, "Calorias (kcal)": 400 },
            { "CHO(g)": 0.00, "Alimento": "LEITE DE COCO", "Medida Usual": "COLHER DE SOPA", "g ou ml": 15, "Calorias (kcal)": 30 },
            { "CHO(g)": 0.00, "Alimento": "AZEITONAS VERDES", "Medida Usual": "UNIDADE", "g ou ml": 4, "Calorias (kcal)": 5 },
            { "CHO(g)": 0.00, "Alimento": "AGRIÃO", "Medida Usual": "FOLHAS", "g ou ml": 10, "Calorias (kcal)": 2 },
            { "CHO(g)": 0.00, "Alimento": "RÚCULA", "Medida Usual": "FOLHAS", "g ou ml": 10, "Calorias (kcal)": 3 },
            { "CHO(g)": 0.00, "Alimento": "SALSÃO", "Medida Usual": "FOLHAS", "g ou ml": 10, "Calorias (kcal)": 2 },
            { "CHO(g)": 0.00, "Alimento": "ESPINAFRE", "Medida Usual": "FOLHAS", "g ou ml": 10, "Calorias (kcal)": 2 },
            { "CHO(g)": 0.00, "Alimento": "AZEITE EXTRA", "Medida Usual": "COLHER DE SOPA", "g ou ml": 14, "Calorias (kcal)": 120 },
            { "CHO(g)": 0.00, "Alimento": "BIFE GRELHADO", "Medida Usual": "BIFE MEDIO", "g ou ml": 100, "Calorias (kcal)": 250 },
            { "CHO(g)": 0.00, "Alimento": "TORRESMO COZIDO", "Medida Usual": "COLHER DE SOPA", "g ou ml": 15, "Calorias (kcal)": 150 },
            { "CHO(g)": 0.00, "Alimento": "ASA DE FRANGO GRELHADA", "Medida Usual": "UNIDADE", "g ou ml": 50, "Calorias (kcal)": 100 },
            { "CHO(g)": 0.00, "Alimento": "QUEIJO REQUEIJÃO", "Medida Usual": "FATIA", "g ou ml": 30, "Calorias (kcal)": 100 },
            { "CHO(g)": 0.00, "Alimento": "CHÁ DE CAMOMILA", "Medida Usual": "XÍCARA", "g ou ml": 240, "Calorias (kcal)": 0 },

            // Itens com CHO
            { "CHO(g)": 2.00, "Alimento": "SUCO DE COUVE", "Medida Usual": "COPO", "g ou ml": 250, "Calorias (kcal)": 10 },
            { "CHO(g)": 12.00, "Alimento": "MARACUJÁ", "Medida Usual": "POLPA", "g ou ml": 100, "Calorias (kcal)": 60 }
        ];

        const generateMenuBtn = document.getElementById('generateMenuBtn');
        const menuContainer = document.getElementById('menu-container');
        const menuContent = document.getElementById('menu-content');
        const totalCarbsSpan = document.getElementById('total-carbs');
        const loadingDiv = document.getElementById('loading');
        const errorMessageDiv = document.getElementById('error-message');
        const successMessageDiv = document.getElementById('success-message');

        const MEAL_CATEGORIES = [
            'Café da manhã',
            'Lanche da manhã',
            'Almoço',
            'Lanche da tarde',
            'Jantar',
            'Lanche da noite'
        ];

        generateMenuBtn.addEventListener('click', () => {
            loadingDiv.classList.remove('hidden');
            menuContainer.classList.add('hidden');
            errorMessageDiv.classList.add('hidden');
            successMessageDiv.classList.add('hidden');
            menuContent.innerHTML = '';
            totalCarbsSpan.textContent = 'Carboidratos Totais: 0g';

            setTimeout(() => {
                try {
                    const menu = generateDailyMenu(data, 15);
                    renderMenu(menu);
                    loadingDiv.classList.add('hidden');
                    successMessageDiv.classList.remove('hidden');
                    menuContainer.classList.remove('hidden');
                } catch (error) {
                    loadingDiv.classList.add('hidden');
                    errorMessageDiv.textContent = error.message;
                    errorMessageDiv.classList.remove('hidden');
                }
            }, 1500); // Atraso para simular a chamada API/Make
        });

        // Função que simula o "cérebro" do Make, com a lógica do plano alimentar
        function generateDailyMenu(carbTable, dailyLimit) {
            let totalCarbs = 0;
            let menu = {};
            MEAL_CATEGORIES.forEach(meal => menu[meal] = []);

            const foodsWithCarbs = carbTable.filter(food => food["CHO(g)"] > 0);
            const foodsWithoutCarbs = carbTable.filter(food => food["CHO(g)"] === 0);

            // Tentar adicionar alimentos específicos do Menu 21 primeiro para as refeições
            const menu21Items = [
                { meal: 'Café da manhã', foods: ["CAFÉ DESCAFEINADO", "SOJA COZIDA", "OVO COZIDO", "SUCO DE COUVE"] },
                { meal: 'Lanche da manhã', foods: ["CREME DE LEITE", "LEITE DE COCO", "AZEITONAS VERDES"] },
                { meal: 'Almoço', foods: ["AGRIÃO", "RÚCULA", "SALSÃO", "ESPINAFRE", "AZEITE EXTRA", "BIFE GRELHADO", "MAIONESE"] },
                { meal: 'Lanche da tarde', foods: ["TORRESMO COZIDO", "AGRIÃO", "RÚCULA", "AZEITE EXTRA", "ASA DE FRANGO GRELHADA", "MARACUJÁ"] },
                { meal: 'Jantar', foods: ["BIFE GRELHADO", "AGRIÃO", "ESPINAFRE", "AZEITE EXTRA", "MAIONESE"] },
                { meal: 'Lanche da noite', foods: ["CREME DE LEITE", "LEITE DE COCO", "QUEIJO REQUEIJÃO", "AZEITONAS VERDES", "CHÁ DE CAMOMILA"] }
            ];

            menu21Items.forEach(item => {
                item.foods.forEach(foodName => {
                    const foundFood = carbTable.find(f => f.Alimento === foodName);
                    if (foundFood && totalCarbs + foundFood["CHO(g)"] <= dailyLimit) {
                        menu[item.meal].push(foundFood);
                        totalCarbs += foundFood["CHO(g)"];
                    }
                });
            });

            // Se o total de CHO ainda for baixo, adicione mais itens aleatórios
            const shuffledZeroCarbFoods = foodsWithoutCarbs.sort(() => 0.5 - Math.random());
            const shuffledCarbFoods = foodsWithCarbs.sort(() => 0.5 - Math.random());

            // Adicionar mais alimentos de 0 CHO para preencher o menu
            shuffledZeroCarbFoods.forEach(food => {
                const randomMeal = MEAL_CATEGORIES[Math.floor(Math.random() * MEAL_CATEGORIES.length)];
                if (menu[randomMeal].length < 3) { // Limita o número de itens por refeição
                    menu[randomMeal].push(food);
                }
            });

            // Adicionar mais alimentos com CHO, se houver espaço
            shuffledCarbFoods.forEach(food => {
                if (totalCarbs + food["CHO(g)"] <= dailyLimit) {
                    const randomMeal = MEAL_CATEGORIES[Math.floor(Math.random() * MEAL_CATEGORIES.length)];
                    if (menu[randomMeal].length < 3) {
                        menu[randomMeal].push(food);
                        totalCarbs += food["CHO(g)"];
                    }
                }
            });
            
            const finalTotalCarbs = Object.values(menu).flat().reduce((sum, food) => sum + food["CHO(g)"], 0);

            if (finalTotalCarbs > dailyLimit) {
                throw new Error("Erro na lógica: Limite de carboidratos excedido.");
            }

            return { menu, totalCarbs: finalTotalCarbs };
        }

        // Função que simula a interface do Lovable renderizando o menu
        function renderMenu(menuData) {
            menuContent.innerHTML = '';
            const { menu, totalCarbs } = menuData;

            MEAL_CATEGORIES.forEach(meal => {
                if (menu[meal].length > 0) {
                    const mealDiv = document.createElement('div');
                    mealDiv.className = 'bg-gray-100 p-4 rounded-lg';
                    
                    const mealTitle = document.createElement('h3');
                    mealTitle.className = 'text-lg font-bold mb-2';
                    mealTitle.textContent = meal;
                    mealDiv.appendChild(mealTitle);

                    const mealList = document.createElement('ul');
                    mealList.className = 'list-disc list-inside space-y-1';
                    menu[meal].forEach(food => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `${food.Alimento} (${food["CHO(g)"]}g CHO)`;
                        mealList.appendChild(listItem);
                    });
                    mealDiv.appendChild(mealList);
                    menuContent.appendChild(mealDiv);
                }
            });
            totalCarbsSpan.textContent = `Carboidratos Totais: ${totalCarbs.toFixed(2)}g`;
        }

    </script>
</body>
</html>
